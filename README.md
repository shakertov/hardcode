# hardcode
Тестовое задание для HardCode.

## Построение архитектуры (3 балла)
В этом задании у нас есть три бизнес-задачи на хранение:
1. Создать сущность продукта. У продукта должен быть владелец. Необходимо добавить сущность для сохранения доступов к продукту для пользователя.
2. Создать сущность урока. Урок может находиться в нескольких продуктах одновременно. В уроке должна быть базовая информация: название, ссылка на видео, длительность просмотра (в секундах).
3. Урок могут просматривать множество пользователей. Необходимо для каждого фиксировать время просмотра и фиксировать статус “Просмотрено”/”Не просмотрено”. Статус “Просмотрено” проставляется, если пользователь просмотрел 80% ролика.

## Написание запросов (7 баллов)
В этом пункте потребуется использовать выполненную вами в прошлом задании архитектуру:
1. Реализовать API для выведения списка всех уроков по всем продуктам к которым пользователь имеет доступ, с выведением информации о статусе и времени просмотра.
2. Реализовать API с выведением списка уроков по конкретному продукту к которому пользователь имеет доступ, с выведением информации о статусе и времени просмотра, а также датой последнего просмотра ролика.
3. Реализовать API для отображения статистики по продуктам. Необходимо отобразить список всех продуктов на платформе, к каждому продукту приложить информацию:

	- Количество просмотренных уроков от всех учеников.
	- Сколько в сумме все ученики потратили времени на просмотр роликов.
	- Количество учеников занимающихся на продукте.
	- Процент приобретения продукта (рассчитывается исходя из количества полученных доступов к продукту деленное на общее количество пользователей на платформе).


## Результат выполнения:
Выполненная архитектура на базе данных SQLite с использованием Django.
Реализованные API на базе готовой архитектуры.

## Установка
Необходимо склонировать репозиторий в рабочую папку, создать виртуальное окружение, активировать его и установить зависимости:
```
git clone ...
python -m venv venv
. venv/bin/activate
pip install -r requirements.txt
```
База данных с тестовыми данными находится в репозитории проекта. Данные суперпользователя: admin@admin.ru admin

## Endpoints API

`/index/` - страница с приветствием.

---

`/all/` - выводит список всех доступных пользователю продуктов со списком уроков.
Для получения списка необходимо отправить методом POST JSON-запрос:
```
{
	"ID_U": :user_id: -> идентификатор пользователя по которому выбираются продукты, доступные пользователю
}
```
Получаемый ответ, пример:
1. Пользователь не отправил идентификатор
```
{
    "error": "Необходимо отправить идентификатор пользователя"
}
```
2. Пользователь отправил идентификатор
```
[
    {
        "id": 1,
        "title": "Поколение Python",
        "description": "Лучший курс по Python на Stepik'e.",
        "lessons": [
            {
                "title": "Изучение Django",
                "description": "В уроке рассматриваются основы работы с Django.",
                "link": "lesson-django",
                "duration": "00:01:40",
                "status": "Просмотрено",
                "last_seen": "2023-09-23T17:28:45.212867Z"
            },
            {
                "title": "Основы Flask",
                "description": "В уроке рассматриваются основы по работе с Flask. Установка, настройка и прочие вещи.",
                "link": "lesson-flask",
                "duration": "00:10:00",
                "status": "Нет данных",
                "last_seen": "Нет данных"
            },
            {
                "title": "SQL",
                "description": "Урок по основам SQL. Выборки, Джоины, запросы и подзапросы.",
                "link": "lesson-sql",
                "duration": "00:06:40",
                "status": "Нет данных",
                "last_seen": "Нет данных"
            }
        ]
    }
]
```

---

`/product/` - выводит список уроков конкретного продукта.
Для получения списка необходимо отправить методом POST JSON-запрос:

```
{
	"ID_U": :user_id:, -> идентификатор пользователя, по которому выбираются продукты, доступные пользователю
	"ID_P": :product_id: -> идентификатор продукта, по которому необходим список
}
```
Получаемый ответ, пример:
1. Если пользователь не отправил идентификатор пользователя или идентификатор продукта
```
{
    "error": "Необходимо отправить идентификатор пользователя и идентификатор продукта"
}
```
2. Если всё отправлено корректно, то выводится список уроков, в доступной для пользователе продукте
```
[
    {
        "title": "Изучение Django",
        "description": "В уроке рассматриваются основы работы с Django.",
        "link": "lesson-django",
        "duration": "00:01:40",
        "status": "Просмотрено",
        "last_seen": "2023-09-23T17:28:45.212867Z"
    },
    {
        "title": "Основы Flask",
        "description": "В уроке рассматриваются основы по работе с Flask. Установка, настройка и прочие вещи.",
        "link": "lesson-flask",
        "duration": "00:10:00",
        "status": "Нет данных",
        "last_seen": "Нет данных"
    },
    {
        "title": "SQL",
        "description": "Урок по основам SQL. Выборки, Джоины, запросы и подзапросы.",
        "link": "lesson-sql",
        "duration": "00:06:40",
        "status": "Нет данных",
        "last_seen": "Нет данных"
    }
]
```
3. Если у пользователя нет доступа к продукту, или пользователя не существует, или продукта не существует
```
{
    "error": "Такого продукта не существует или у пользователя нет доступа к нему"
}
```

---

`/statistic/` - выводит статистику по всем
При обращение GET запросом без всяких параметров будет возвращена статистика по всем продуктам в отдельности
```
[
    {
        "id": 1,
        "title": "Поколение Python",
        "description": "Лучший курс по Python на Stepik'e.",
        "total_views": 4,
        "total_duration": "0:18:01",
        "total_students": 1,
        "total_purchase": "25.0 %"
    },
    {
        "id": 2,
        "title": "Yandex Praktikum Python",
        "description": "Курс от Яндекса для разработчиков",
        "total_views": 2,
        "total_duration": "0:08:20",
        "total_students": 3,
        "total_purchase": "75.0 %"
    },
    {
        "id": 3,
        "title": "SkillBox Python",
        "description": "Курс от конкурентов Яндекса по образовательным программам IT специальностей.",
        "total_views": 2,
        "total_duration": "0:08:20",
        "total_students": 1,
        "total_purchase": "25.0 %"
    }
]
```

Где

	`total_views` - общее количество просмотров уроков, принадлежащих данному продукту
	`total_duration` - общая продолжительность просмотра уроков, принадлежащих данному продукту, пользователями
	`total_students` - общее количество студентов, которые имеют доступ к курсу
	`total_purchase` - процент покупок относительно всех пользователей на платформе

